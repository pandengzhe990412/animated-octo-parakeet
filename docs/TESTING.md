# 🧪 扩展测试指南

## ✅ UI 已显示，现在测试内容抓取功能

### 步骤 1：重新加载扩展

1. 打开 `chrome://extensions/`
2. 找到"飞书文档转公众号助手"
3. 点击右下角的重新加载按钮（🔄）

---

### 步骤 2：打开飞书文档

在 Chrome 中打开一个飞书文档：
```
https://feishu.cn/doc/xxxxx
```

**推荐测试文档**：
- 任意飞书文档（包含标题、段落、列表）
- 可以新建一个测试文档

---

### 步骤 3：打开扩展侧边栏

1. 点击 Chrome 右上角的扩展图标（蓝色图标）
2. 侧边栏应该从右侧滑出

---

### 步骤 4：抓取文档内容

#### 方式 A：自动抓取（如果已实现）

侧边栏打开后，应该会自动抓取文档内容

#### 方式 B：手动刷新

点击侧边栏底部的 **"刷新"** 按钮

---

### 步骤 5：查看结果

#### 成功的标志：

**状态栏显示**：
```
📱 文档标题  [编辑][预览]
```

**预览区域显示**：
- 标题
- 正文内容
- 列表、代码块等格式

**底部按钮状态**：
- "复制"按钮应该变为可点击状态（蓝色）

#### 失败的情况：

如果看到以下消息，说明需要调试：

```
请打开飞书文档页面，然后点击刷新按钮。

支持的域名：
- *.feishu.cn
- *.larksuite.com
```

---

## 🔍 调试步骤

### 1. 打开浏览器控制台

```
按 F12 或 Ctrl+Shift+J
```

切换到 **Console** 标签，查看是否有错误信息

### 2. 查看扩展日志

在控制台中，应该能看到以下日志：

```
[Content Script] Starting extraction...
[Content Script] Searching in document: https://...
[Content Script] Found [data-node-type="page"]: XXX chars
[Content Script] Extracted title: XXX
[Content Script] HTML length: XXX
```

### 3. 手动测试抓取函数

在控制台中运行：

```javascript
// 检查是否在飞书页面
console.log(window.location.href)

// 检查文档元素
document.querySelector('[data-node-type="page"]')
document.querySelector('.lark-doc-content')
document.querySelector('article')
```

---

## ⚠️ 常见问题

### 问题 1：侧边栏显示"请打开飞书文档页面"

**原因**：当前不在飞书文档页面

**解决**：
1. 打开一个飞书文档
2. 等待页面完全加载
3. 点击侧边栏的"刷新"按钮

---

### 问题 2：显示"无法找到文档内容"

**原因**：
- 页面还没有完全加载
- 或者飞书更新了 DOM 结构

**解决**：
1. 刷新飞书文档页面（F5）
2. 等待页面完全加载
3. 点击侧边栏的"刷新"按钮

---

### 问题 3：显示"获取失败"

**原因**：
- 权限问题
- 或者跨域问题

**解决**：
1. 检查扩展权限：
   - 打开 `chrome://extensions/`
   - 找到扩展，点击"详细信息"
   - 检查权限是否包含：
     - ✅ 存储数据
     - ✅ 活动标签页
     - ✅ 剪贴板写入
     - ✅ 侧边栏

2. 重新加载扩展：
   - 点击"重新加载"按钮

---

## 📸 预期界面

### 成功抓取后，侧边栏应显示：

```
┌─────────────────────────────────────┐
│ 📱 我的文档标题      [编辑][预览]   │
├─────────────────────────────────────┤
│                                     │
│   ┌─────────────────────────────┐  │
│   │  ┌─────────────────────┐   │  │
│   │  │  📱 手机预览框        │   │  │
│   │  │                     │   │  │
│   │  │  # 标题             │   │  │
│   │  │                     │   │  │
│   │  │  正文内容...        │   │  │
│   │  │                     │   │  │
│   │  │  - 列表项          │   │  │
│   │  │                     │   │  │
│   │  └─────────────────────┘   │  │
│   └─────────────────────────────┘  │
│                                     │
├─────────────────────────────────────┤
│ [科技蓝 ▼] [AI润色]     [刷新][复制] │
└─────────────────────────────────────┘
```

---

## 🎯 下一步功能测试

抓取成功后，可以测试：

### 1. 切换主题
- 点击"科技蓝"下拉菜单
- 选择"简约白"或"商务黑"
- 预览区域样式应该改变

### 2. 编辑 Markdown
- 点击顶部状态栏的"编辑"按钮
- 在文本框中编辑 Markdown
- 切换回"预览"查看效果

### 3. 复制到公众号
- 点击底部的"复制"按钮
- 按钮应该变为绿色"✓ 已复制"
- 粘贴到微信公众号编辑器测试

---

## 💡 调试技巧

### 查看完整的抓取结果

在控制台运行：
```javascript
chrome.tabs.query({active: true}, (tabs) => {
  chrome.scripting.executeScript({
    target: { tabId: tabs[0].id },
    func: () => {
      return {
        title: document.title,
        html: document.body.innerHTML.substring(0, 500)
      }
    }
  }, (results) => {
    console.log(results[0].result)
  })
})
```

### 检查 Content Script 是否加载

1. 打开飞书文档页面
2. 按 F12 打开开发者工具
3. 切换到 **Console** 标签
4. 应该看到：
```
Gongzhonghao content script loaded on Feishu/Lark page
```

---

## 📝 报告问题时请提供

1. 飞书文档的 URL（可以打码）
2. 浏览器控制台的完整错误信息
3. 扩展侧边栏显示的消息
4. 截图（如果可能）

---

**更新时间**：2026-02-06
